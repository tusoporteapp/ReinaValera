import{g as P,j as e,P as d}from"./index-C0JCaVPh.js";import{u as D,r as n}from"./react-vendor-KOjhOASN.js";import{L as I}from"./LikeButton-Bp0BxRGM.js";import{H as z,a2 as C,P as E,l as S,a1 as f,a3 as $,a4 as A}from"./ui-vendor-DC5Jkz16.js";import"./firebase-vendor-CMaS3_GD.js";import"https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";import"https://www.gstatic.com/firebasejs/12.6.0/firebase-messaging.js";const W=({onNotify:p})=>{const u=D(),{currentTrack:x,isPlaying:m,play:b,pause:j,lastEndedTrackId:o}=P(),[w,g]=n.useState([]),[v,h]=n.useState(null),[c,k]=n.useState(()=>{try{return JSON.parse(localStorage.getItem("played_podcasts")||"[]")}catch{return[]}});n.useEffect(()=>{if(o&&!c.includes(o)){const s=[...c,o];k(s),localStorage.setItem("played_podcasts",JSON.stringify(s)),p("Podcast completado y marcado como escuchado","success")}},[o]),n.useEffect(()=>{(async()=>{const a=await caches.open("audio-cache-v1"),r=await a.keys();d.filter(t=>r.some(l=>l.url.includes(encodeURI(t.url)))).map(t=>t.id);const i=[];for(const t of d)await a.match(t.url)&&i.push(t.id);g(i)})()},[]);const N=async s=>{h(s.id);try{await(await caches.open("audio-cache-v1")).add(s.url),g(r=>[...r,s.id]),p("Podcast descargado para escuchar offline","success")}catch(a){console.error("Download failed:",a),p("Error al descargar. Verifica tu conexión.","error")}finally{h(null)}};return e.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar bg-gray-50 dark:bg-[#121212] pb-32 relative",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-gradient-to-r from-indigo-900 to-purple-800 px-6 py-6 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center",children:e.jsx(z,{size:24,className:"text-white"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:"Podcasts Bíblicos"}),e.jsxs("p",{className:"text-purple-100 text-sm",children:[d.length," episodios disponibles"]})]})]}),e.jsxs("div",{className:"text-xs font-bold bg-white/20 backdrop-blur-sm text-white px-3 py-1.5 rounded-lg uppercase tracking-wider flex items-center gap-1.5",children:[e.jsx(C,{size:12}),"Online"]})]})}),e.jsxs("div",{className:"p-4 space-y-4",children:[[...d].sort((s,a)=>{const r=c.includes(s.id)?1:0,i=c.includes(a.id)?1:0;return r-i}).map(s=>{const a=s.url.includes("drive.google.com")&&s.url.includes("preview"),r=!a&&(x==null?void 0:x.id)===s.id,i=r&&m,t=w.includes(s.id),l=c.includes(s.id),y=v===s.id;return e.jsx("article",{className:`
                                bg-white dark:bg-[#1a1a1a] rounded-2xl overflow-hidden shadow-sm border transition-all 
                                ${r?"border-purple-500 ring-1 ring-purple-500/20":"border-gray-100 dark:border-gray-800"}
                                ${l?"opacity-70 grayscale-[0.3] hover:opacity-100 hover:grayscale-0":""}
                            `,children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex justify-between items-start gap-4",children:[e.jsx("button",{onClick:()=>{a?u(`/podcast/${s.id}`):r&&m?j():b(s)},className:`flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center transition-all ${i?"bg-purple-600 text-white shadow-lg shadow-purple-500/30":l?"bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-purple-100 dark:hover:bg-purple-900/20"}`,children:i?e.jsx(E,{size:20,fill:"currentColor"}):e.jsx(S,{size:20,fill:"currentColor",className:"ml-1"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsxs("div",{className:"pr-2",children:[e.jsx("h3",{onClick:()=>u(`/podcast/${s.id}`),className:`text-lg font-bold leading-tight cursor-pointer hover:underline ${r?"text-purple-600 dark:text-purple-400":"text-gray-900 dark:text-white"}`,children:s.title}),l&&e.jsxs("span",{className:"inline-flex items-center gap-1 mt-1 px-1.5 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300",children:[e.jsx(f,{size:10,strokeWidth:3})," Escuchado"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t?e.jsx("span",{className:"p-1.5 text-green-500",title:"Descargado",children:e.jsx(f,{size:18})}):e.jsx("button",{onClick:()=>N(s),disabled:y,className:"p-1.5 text-gray-400 hover:text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-full transition-colors","aria-label":"Descargar para escuchar offline",children:y?e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-purple-500 border-t-transparent rounded-full"}):e.jsx($,{size:18})}),e.jsx(I,{itemId:s.id,itemType:"podcast",itemTitle:s.title})]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-2 font-serif mb-3",children:s.description})]})]})})},s.id)}),d.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-400",children:[e.jsx(A,{size:48,className:"mb-4 opacity-50"}),e.jsx("p",{children:"No hay podcasts disponibles aún."})]})]})]})};export{W as default};
