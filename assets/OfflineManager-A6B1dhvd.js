import{n,o as j,r as y,k as N,j as e,l as k,p as v}from"./index-DnOXmCtZ.js";import{r as g,u as w}from"./react-vendor-B6z1n1mp.js";import{I as E,ac as L,f as h,e as A,D as C,F as q}from"./ui-vendor-CLl8kLQA.js";import"./firebase-vendor-adPvufnm.js";import"https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";import"https://www.gstatic.com/firebasejs/12.6.0/firebase-messaging.js";function z(){const[s,o]=g.useState({used:0,available:0,quota:0,configuredLimit:10737418240,percentUsed:0,episodes:0,isPersistent:!1}),[c,d]=g.useState(!0),a=async()=>{try{d(!0);const r=await j();o(r)}catch(r){console.error("Error getting storage info:",r)}finally{d(!1)}},l=async()=>{try{const r=await y();return await a(),r}catch(r){return console.error("Error requesting persistent storage:",r),!1}};g.useEffect(()=>{a()},[]);const i=s.percentUsed>90,x=s.used>=s.configuredLimit,m={used:n(s.used),available:n(s.available),quota:n(s.quota),configuredLimit:n(s.configuredLimit),percentUsed:Math.round(s.percentUsed)};return{storageInfo:s,formatted:m,loading:c,isNearLimit:i,isAtLimit:x,refresh:a,requestPersistent:l}}const B=()=>{const{downloadedEpisodes:s,deleteEpisode:o,loading:c}=N(),{storageInfo:d,formatted:a,isNearLimit:l,isAtLimit:i,loading:x,requestPersistent:m}=z(),r=w(),p=async(t,f)=>{if(confirm(`Â¿Eliminar "${f}" de las descargas?`))try{await o(t)}catch{alert("Error al eliminar el episodio")}},u=async()=>{if(s.length!==0&&confirm(`Â¿Eliminar TODOS los ${s.length} episodios descargados?`))try{await v(),window.location.reload()}catch{alert("Error al eliminar todas las descargas")}},b=async()=>{const t=await m();alert(t?"âœ… Almacenamiento persistente activado":"âŒ No se pudo activar el almacenamiento persistente")};return c||x?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-[#121212]",children:e.jsx(E,{size:48,className:"animate-spin text-purple-600"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-[#121212] pb-32",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-900 to-purple-800 px-6 py-8 shadow-lg",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center",children:e.jsx(L,{size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"GestiÃ³n Offline"}),e.jsxs("p",{className:"text-purple-100 text-sm",children:[s.length," episodios descargados"]})]})]})})}),e.jsxs("div",{className:"max-w-4xl mx-auto p-4 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-[#1a1a1a] rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-gray-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Almacenamiento"}),e.jsxs("span",{className:`text-sm font-bold px-3 py-1 rounded-full ${i?"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300":l?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300":"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300"}`,children:[a.percentUsed,"% usado"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-2",children:[e.jsx("span",{children:a.used}),e.jsx("span",{children:a.configuredLimit})]}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-800 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-300 ${i?"bg-red-500":l?"bg-yellow-500":"bg-gradient-to-r from-blue-500 to-purple-500"}`,style:{width:`${Math.min(a.percentUsed,100)}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-6",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-xl p-4",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-1",children:"Espacio Usado"}),e.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:a.used})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-xl p-4",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-1",children:"Cuota del Navegador"}),e.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:a.quota})]})]}),i&&e.jsxs("div",{className:"mt-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4 flex items-start gap-3",children:[e.jsx(h,{size:20,className:"text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-red-900 dark:text-red-100",children:[e.jsx("strong",{children:"LÃ­mite alcanzado:"})," No puedes descargar mÃ¡s episodios. Elimina algunos para liberar espacio."]})]}),l&&!i&&e.jsxs("div",{className:"mt-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-xl p-4 flex items-start gap-3",children:[e.jsx(h,{size:20,className:"text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-900 dark:text-yellow-100",children:[e.jsx("strong",{children:"Advertencia:"})," EstÃ¡s usando mÃ¡s del 90% del espacio configurado (",a.configuredLimit,")."]})]}),!d.isPersistent&&e.jsx("div",{className:"mt-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-bold text-blue-900 dark:text-blue-100 mb-1",children:"ðŸ’¡ Almacenamiento No Persistente"}),e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:"Las descargas podrÃ­an ser eliminadas automÃ¡ticamente por el navegador. Activa el almacenamiento persistente para mayor seguridad."})]}),e.jsx("button",{onClick:b,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-bold whitespace-nowrap transition-colors",children:"Activar"})]})}),d.isPersistent&&e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-sm text-green-600 dark:text-green-400",children:[e.jsx(A,{size:16}),e.jsx("span",{children:"Almacenamiento persistente activado"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#1a1a1a] rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-gray-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Episodios Descargados"}),s.length>0&&e.jsx("button",{onClick:u,className:"text-sm font-bold text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 transition-colors",children:"Eliminar Todos"})]}),s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(C,{size:48,className:"mx-auto mb-4 text-gray-300 dark:text-gray-700"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No tienes episodios descargados"}),e.jsx("button",{onClick:()=>r("/podcasts"),className:"mt-4 px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-bold transition-colors",children:"Explorar Podcasts"})]}):e.jsx("div",{className:"space-y-3",children:s.map(t=>e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 dark:bg-gray-800/50 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:[e.jsx("img",{src:t.podcast.thumbnail,alt:t.podcast.title,className:"w-16 h-16 rounded-lg object-cover flex-shrink-0 cursor-pointer",onClick:()=>r(`/podcast/${t.id}`)}),e.jsxs("div",{className:"flex-1 min-w-0 cursor-pointer",onClick:()=>r(`/podcast/${t.id}`),children:[e.jsx("h3",{className:"font-bold text-gray-900 dark:text-white text-sm leading-tight mb-1 truncate",children:t.podcast.title}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:[(t.size/(1024*1024)).toFixed(1)," MB"]}),t.podcast.duration>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:k(t.podcast.duration)})]})]})]}),e.jsx("button",{onClick:()=>p(t.id,t.podcast.title),className:"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors flex-shrink-0","aria-label":"Eliminar descarga",children:e.jsx(q,{size:20})})]},t.id))})]})]})]})};export{B as default};
