const l="bible-personal-notes",g={generateId(){return`note-${Date.now()}-${Math.random().toString(36).substr(2,9)}`},getAllNotes(){try{const e=localStorage.getItem(l);return e?JSON.parse(e):[]}catch(e){return console.error("[NotesManager] Error al cargar notas:",e),[]}},saveAllNotes(e){try{localStorage.setItem(l,JSON.stringify(e)),console.log(`[NotesManager] ${e.length} notas guardadas`)}catch(s){throw console.error("[NotesManager] Error al guardar notas:",s),new Error("No se pudieron guardar las notas")}},createNote(e){const s={...e,id:this.generateId(),createdAt:Date.now(),updatedAt:Date.now()},t=this.getAllNotes();return t.push(s),this.saveAllNotes(t),console.log("[NotesManager] Nota creada:",s.id),s},updateNote(e,s){const t=this.getAllNotes(),o=t.findIndex(r=>r.id===e);return o===-1?(console.warn("[NotesManager] Nota no encontrada:",e),null):(t[o]={...t[o],...s,updatedAt:Date.now()},this.saveAllNotes(t),console.log("[NotesManager] Nota actualizada:",e),t[o])},deleteNote(e){const s=this.getAllNotes(),t=s.filter(o=>o.id!==e);return t.length===s.length?(console.warn("[NotesManager] Nota no encontrada para eliminar:",e),!1):(this.saveAllNotes(t),console.log("[NotesManager] Nota eliminada:",e),!0)},getNotesForVerse(e,s,t){return this.getAllNotes().filter(r=>r.bookId===e&&r.chapterIndex===s&&r.verseIndex===t)},getNotesForChapter(e,s){return this.getAllNotes().filter(o=>o.bookId===e&&o.chapterIndex===s)},searchNotes(e){if(!e.trim())return[];const s=this.getAllNotes(),t=e.toLowerCase();return s.filter(o=>o.noteText.toLowerCase().includes(t)||o.verseText.toLowerCase().includes(t)||o.bookName.toLowerCase().includes(t)||o.tags.some(r=>r.toLowerCase().includes(t)))},getNotesByTag(e){return this.getAllNotes().filter(t=>t.tags.some(o=>o.toLowerCase()===e.toLowerCase()))},getAllTags(){const e=this.getAllNotes(),s=new Set;return e.forEach(t=>{t.tags.forEach(o=>s.add(o))}),Array.from(s).sort()},exportNotes(){const e=this.getAllNotes();return JSON.stringify(e,null,2)},importNotes(e,s=!1){try{const t=JSON.parse(e);if(!Array.isArray(t))return{success:!1,count:0,error:"Formato inválido: no es un array"};const o=t.filter(r=>r.id&&r.bookId&&r.noteText);if(o.length===0)return{success:!1,count:0,error:"No se encontraron notas válidas"};if(s){const r=this.getAllNotes(),a=new Set(r.map(n=>n.id)),c=o.filter(n=>!a.has(n.id)),i=[...r,...c];return this.saveAllNotes(i),{success:!0,count:c.length}}else return this.saveAllNotes(o),{success:!0,count:o.length}}catch(t){return console.error("[NotesManager] Error al importar:",t),{success:!1,count:0,error:t instanceof Error?t.message:"Error desconocido"}}},getStats(){const e=this.getAllNotes(),s={},t={},o={};return e.forEach(r=>{s[r.bookName]=(s[r.bookName]||0)+1,r.tags.forEach(a=>{t[a]=(t[a]||0)+1}),r.color&&(o[r.color]=(o[r.color]||0)+1)}),{total:e.length,byBook:s,byTag:t,byColor:o}},clearAllNotes(){localStorage.removeItem(l),console.log("[NotesManager] Todas las notas eliminadas")}};export{g as n};
