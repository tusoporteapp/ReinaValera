import{r}from"./react-vendor-B6z1n1mp.js";import{p as m,q as y,s as D,v as M}from"./index-Dp8SMGGx.js";function b(){const[d,c]=r.useState([]),[n,t]=r.useState(new Map),[w,l]=r.useState(!0);r.useEffect(()=>{a()},[]);const a=async()=>{try{l(!0);const e=await m();c(e)}catch(e){console.error("Error loading downloaded episodes:",e)}finally{l(!1)}},p=r.useCallback(async e=>{try{t(s=>new Map(s).set(e.id,{episodeId:e.id,state:"downloading",progress:0}));const o=await y(e,s=>{t(i=>new Map(i).set(e.id,{episodeId:e.id,state:"downloading",progress:s}))});return t(s=>new Map(s).set(e.id,{episodeId:e.id,state:"completed",progress:100})),await a(),o}catch(o){throw console.error("Error downloading episode:",o),t(s=>new Map(s).set(e.id,{episodeId:e.id,state:"error",progress:0,error:o instanceof Error?o.message:"Error desconocido"})),o}},[]),u=r.useCallback(async e=>{try{await D(e),await a(),t(o=>{const s=new Map(o);return s.delete(e),s})}catch(o){throw console.error("Error deleting episode:",o),o}},[]),g=r.useCallback(async e=>await M(e),[]),E=r.useCallback(e=>{const o=n.get(e);return o?o.state:d.some(i=>i.id===e)?"completed":"none"},[n,d]),f=r.useCallback(e=>{const o=n.get(e);return(o==null?void 0:o.progress)||0},[n]);return{downloadedEpisodes:d,loading:w,download:p,deleteEpisode:u,isDownloaded:g,getDownloadState:E,getProgress:f,refresh:a}}export{b as u};
